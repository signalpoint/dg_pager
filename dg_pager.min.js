function dg_pager_pre_process_route_change(t,e){"undefined"!=typeof e&&dg_pager.clearAll()}dg.createModule("dg_pager"),dg._pagers={};var Pager=function(t,e){if(this._id=t,this._variables=e,this._query=null,this._locked=!1,this._data={page:"undefined"!=typeof e._page?e._page:0,limit:e._limit?e._limit:20},e._infinite){var r={trimFromTop:!1,pagesAllowed:32};e._infiniteOps?e._infiniteOps=dg.extend(r,e._infiniteOps):e._infiniteOps=r,this._firstObserver=null,this._lastObserver=null}dg._pagers[this.id()]=this};Pager.prototype.id=function(){return this._id},Pager.prototype.getVars=function(){return this._variables},Pager.prototype.getVar=function(t){return this.getVars()["_"+t]},Pager.prototype.getOption=function(t){return this.getVars()._infiniteOps[t]},Pager.prototype.getFetcher=function(){return this.getVar("fetcher")},Pager.prototype.getWrapperId=function(){return this.getVar("wrapperId")},Pager.prototype.getWrapper=function(){return this.getVar("wrapper")},Pager.prototype.getWrapperTheme=function(){return this.getWrapper().call(this,{})._theme},Pager.prototype.getDisplay=function(){return this.getVar("display")},Pager.prototype.getEmpty=function(){return this.getVar("empty")},Pager.prototype.runDone=function(){var t=this.getVar("done");t&&t.call(this)},Pager.prototype.getList=function(){return dg.qs("#"+this.getWrapperId())},Pager.prototype.getItems=function(){return this.getList().children},Pager.prototype.getItem=function(t){return this.getItems()[t]},Pager.prototype.setData=function(t){this._data=t},Pager.prototype.setPage=function(t){this.getData().page=t},Pager.prototype.setPages=function(t){this.getData().pages=t},Pager.prototype.setLimit=function(t){this.getData().limit=t},Pager.prototype.setCount=function(t){this.getData().count=t},Pager.prototype.setQuery=function(t){this._query=t},Pager.prototype.getData=function(t){return t?this._data[t]:this._data},Pager.prototype.getResults=function(){return this.getData("results")},Pager.prototype.getResultCount=function(){var t=this.getResults();return t?t.length:0},Pager.prototype.getPage=function(){return this.getData("page")},Pager.prototype.getPages=function(){return this.getData("pages")},Pager.prototype.getLimit=function(){return this.getData("limit")},Pager.prototype.getCount=function(){return this.getData("count")},Pager.prototype.getQuery=function(){return this._query},Pager.prototype.isLocked=function(){return this._locked},Pager.prototype.lock=function(){this._locked=!0},Pager.prototype.unlock=function(){this._locked=!1},Pager.prototype.html=function(){var t=dg.attributes(this.getVar("attributes"));return"<div "+t+"></div>"},Pager.prototype.fetch=function(){var t=this,e=this.getFetcher();return this.setQuery({page:this.getPage(),pageSize:this.getLimit()}),new Promise(function(r,i){e.call(t,t.getQuery()).then(function(e){t.setData(e),r()})})},Pager.prototype.render=function(){var t=this;return new Promise(function(e,r){t.fetch().then(function(){var r=dg.qs("#"+t.id());if(t.getResultCount()){var i=t.isInfinite(),n=t.renderRows(),o=i?"":t.renderPager(),s=t.getWrapper().call(t,n);r.innerHTML=dg.render(s)+o,i?(t.runDone(),t.toInfinityAndBeyond(),e&&e()):e()}else{var a=t.getEmpty();a&&(r.innerHTML=dg.render(a.call(t)))}})})},Pager.prototype.renderRows=function(){for(var t=this,e=[],r=this.getResults(),i=this.isInfinite(),n=r.length,o=t.getDisplay(),s=0;s<n;s++){var a=r[s],g=o.call(t,a);dg.isString(g)&&(g={_text:g}),dg.isString(g._text)&&(g._text={_markup:g._text}),dg.attributesInit(g._text);var p=g._text._attributes.class;p.push(s%2?"even":"odd"),i?0==s&&0==t.getPage()?p.push("first"):s==n-1&&p.push("last"):0==s?p.push("first"):s==n-1&&p.push("last"),e.push(g)}return e},Pager.prototype.renderPager=function(){var t=this.id(),e=0!=this.getPage()?dg.b(dg.t("Go back"),{_attributes:{onclick:"dg_pager.onclickHandler('"+t+"', 'prev')"}}):"",r=this.getPage()!=this.getPages()-1?dg.b(dg.t("Load more"),{_attributes:{onclick:"dg_pager.onclickHandler('"+t+"', 'next')"}}):"";return e+r},dg_pager.load=function(t){return dg._pagers[t]?dg._pagers[t]:null},dg_pager.clearAll=function(){for(var t in dg._pagers)if(dg._pagers.hasOwnProperty(t)){var e=dg._pagers[t];e._firstObserver&&e._firstObserver.disconnect(),e._lastObserver&&e._lastObserver.disconnect()}},dg_pager.onclickHandler=function(t,e){var r=dg_pager.load(t),i=r.getPage();r.setPage("next"==e?i+1:i-1),r.render().then(function(){dg.qs("#"+r.id()).scrollIntoView()})},Pager.prototype.toInfinityAndBeyond=function(){var t=this,e=document.getElementById(this.getVar("wrapperId"));if(e){var r={root:null,rootMargin:"0px",threshold:1};if(t.getOption("trimFromTop")&&t.getPage()&&t.getPagesInDom()>=t.pagesAllowed()){var i=e.firstChild,n=null;this._firstObserver&&(this._firstObserver.disconnect(),delete this._firstObserver),this._firstObserver=new IntersectionObserver(function(e,r){e.forEach(function(e){e.isIntersecting&&(e.intersectionRatio>n&&t._toInfinityAndBeyond("up"),n=e.intersectionRatio)})},r),this._firstObserver.observe(i)}var o=t.getPages();if(o>1&&t.getPage()+1!=o){var s=e.lastChild,a=null;this._lastObserver&&(this._lastObserver.disconnect(),delete this._lastObserver),this._lastObserver=new IntersectionObserver(function(e,r){e.forEach(function(e){e.isIntersecting&&(e.intersectionRatio>a&&t._toInfinityAndBeyond("down"),a=e.intersectionRatio)})},r),this._lastObserver.observe(s)}}},Pager.prototype._toInfinityAndBeyond=function(t){var e=this;if(!this.isLocked()){var r=this.getDirection(),i=r&&r!=t;this.setDirection(t);var n="down"==t,o=this.getPage(),s=this.pagesAllowed(),a=null;if(a=n?i?o+s:o+1:i?o-s:o-1,!(a<0||a>=this.getPages())){var g=this.getWrapperTheme(),p=this.getPagesInDom();if(e.getOption("trimFromTop")&&p>=s){var u=null;n?(this.removeFromTop(),u=this.getLimit()*(s-1)-1,this.getItem(u).scrollIntoView({block:"end",inline:"start"})):(this.removeFromBottom(),u=this.getLimit()-1)}this.setPage(a),this.lock(),this.fetch().then(function(){e.unlock();for(var t=e.renderRows(),r="",i=0;i<t.length;i++){var o=t[i];switch(g){case"item_list":case"bootstrap_item_list":"bootstrap_item_list"==g&&dg_bootstrap.prepListItem(o),r+=dg.render({_theme:"list_item",_item:o,_i:i*a+i,_total:t.length});break;case"container":r+=dg.render(o)}}var s=dg.qs("#"+e.getWrapperId());n?s.innerHTML+=r:(s.insertAdjacentHTML("afterbegin",r),u=e.getLimit()-1,e.getItem(u).scrollIntoView()),e.runDone(),e.toInfinityAndBeyond()})}}},Pager.prototype.isInfinite=function(){return this.getVar("infinite")},Pager.prototype.getDirection=function(){return this._direction},Pager.prototype.setDirection=function(t){this._direction=t},Pager.prototype.getRowCountInDom=function(){return this.getList().childElementCount},Pager.prototype.pagesAllowed=function(){return this.getOption("pagesAllowed")},Pager.prototype.getPagesInDom=function(){return Math.ceil(this.getRowCountInDom()/this.getLimit())},Pager.prototype.removeFromTop=function(){for(var t=this.getList(),e=this.getLimit(),r=0;r<e;r++){var i=t.childNodes[0];t.removeChild(i)}},Pager.prototype.removeFromBottom=function(){for(var t=this.getList(),e=t.childNodes.length,r=e-this.getLimit(),i=e-1;i>=r;i--){var n=t.childNodes[i];t.removeChild(n)}},dg.theme_pager=function(t){var e=t._attributes.id,r=dg_pager.load("id");return r||(r=new Pager(e,t)),setTimeout(function(){r.render()},1),r.html()};