function onVisibilityChange(t,e){var r;return function(){var n=dg_pager.isElementInViewport(t);n!=r&&(r=n,"function"==typeof e&&e(n))}}function dg_pager_pre_process_route_change(t,e){"undefined"==typeof e||dg_pager.clearAll()}dg.createModule("dg_pager"),dg._pagers={};var Pager=function(t,e){this._id=t,this._variables=e,this._query=null,this._eventsAdded=!1,this._data={page:"undefined"!=typeof e._page?e._page:0,limit:e._limit?e._limit:10},dg._pagers[this.id()]=this};Pager.prototype.id=function(){return this._id},Pager.prototype.getVars=function(){return this._variables},Pager.prototype.getVar=function(t){return this.getVars()["_"+t]},Pager.prototype.getFetcher=function(){return this.getVar("fetcher")},Pager.prototype.getWrapperId=function(){return this.getVar("wrapperId")},Pager.prototype.getWrapper=function(){return this.getVar("wrapper")},Pager.prototype.getWrapperTheme=function(){return this.getWrapper().call(this,{})._theme},Pager.prototype.getDisplay=function(){return this.getVar("display")},Pager.prototype.setData=function(t){this._data=t},Pager.prototype.setPage=function(t){this.getData().page=t},Pager.prototype.setPages=function(t){this.getData().pages=t},Pager.prototype.setLimit=function(t){this.getData().limit=t},Pager.prototype.setCount=function(t){this.getData().count=t},Pager.prototype.setQuery=function(t){this._query=t},Pager.prototype.getData=function(t){return t?this._data[t]:this._data},Pager.prototype.getResults=function(){return this.getData("results")},Pager.prototype.getResultCount=function(){var t=this.getResults();return t?t.length:0},Pager.prototype.getPage=function(){return this.getData("page")},Pager.prototype.getPages=function(){return this.getData("pages")},Pager.prototype.getLimit=function(){return this.getData("limit")},Pager.prototype.getCount=function(){return this.getData("count")},Pager.prototype.getQuery=function(){return this._query},Pager.prototype.html=function(){var t=dg.attributes(this.getVar("attributes"));return"<div "+t+"></div>"},Pager.prototype.fetch=function(){var t=this,e=this.getFetcher();return this.setQuery({page:this.getPage(),pageSize:this.getLimit()}),new Promise(function(r,n){e(t.getQuery()).then(function(e){t.setData(e),r()})})},Pager.prototype.render=function(){var t=this;return new Promise(function(e,r){t.fetch().then(function(){var r=t.isInfinite(),n=t.renderRows(),i=r?"":t.renderPager();dg.qs("#"+t.id()).innerHTML=dg.render(t.getWrapper().call(t,n))+i,r?(t.toInfinityAndBeyond(),e&&e()):e()})})},Pager.prototype.renderRows=function(){for(var t=this,e=[],r=this.getResults(),n=this.isInfinite(),i=r.length,a=t.getDisplay(),o=0;o<i;o++){var g=r[o],s=a.call(t,g);dg.isString(s)&&(s={_text:s}),dg.isString(s._text)&&(s._text={_markup:s._text}),dg.attributesInit(s._text);var p=s._text._attributes.class;p.push(o%2?"even":"odd"),n?0==o&&0==t.getPage()?p.push("first"):o==i-1&&p.push("last"):0==o?p.push("first"):o==i-1&&p.push("last"),e.push(s)}return e},Pager.prototype.renderPager=function(){var t=this.id(),e=0!=this.getPage()?dg.b(dg.t("Go back"),{_attributes:{onclick:"dg_pager.onclickHandler('"+t+"', 'prev')"}}):"",r=this.getPage()!=this.getPages()-1?dg.b(dg.t("Load more"),{_attributes:{onclick:"dg_pager.onclickHandler('"+t+"', 'next')"}}):"";return e+r},Pager.prototype.isInfinite=function(){return this.getVar("infinite")},Pager.prototype.eventsAdded=function(){return this._eventsAdded},Pager.prototype.addEvents=function(){var t=this;if(window.addEventListener){var e=dg_pager.infiniteScrollEventListeners();e.forEach(function(e){addEventListener(e,t.onVisibilityChangeHandler,!1)})}else if(window.attachEvent){var r=dg_pager.infiniteScrollEvents();r.forEach(function(e){attachEvent(e,t.onVisibilityChangeHandler,!1)})}t._eventsAdded=!0},Pager.prototype.removeEvents=function(){var t=this;if(window.removeEventListener)for(var e=dg_pager.infiniteScrollEventListeners(),r=0;r<e.length;r++)removeEventListener(e[r],t.onVisibilityChangeHandler);else if(window.removeEvent)for(var n=dg_pager.infiniteScrollEvents(),i=0;i<n.length;i++)removeEvent(n[i],t.onVisibilityChangeHandler);t._eventsAdded=!1},Pager.prototype.toInfinityAndBeyond=function(){var t=this,e=this.getWrapperTheme(),r=document.getElementById(this.getVar("wrapperId")),n=r?r.lastChild:null;this.onVisibilityChangeHandler=onVisibilityChange(n,function(r){if(r){t.removeEvents();var n="next",i=t.getPage(),a="next"==n?i+1:i-1;if(a<0)return;if(a>=t.getPages())return;t.setPage(a),t.fetch().then(function(){for(var r=t.renderRows(),n="",i=0;i<r.length;i++){var o=r[i];switch(e){case"bootstrap_item_list":dg_bootstrap.prepListItem(o),n+=dg.render({_theme:"list_item",_item:o,_i:i*a+i,_total:r.length});break;case"container":n+=dg.render(o)}}dg.qs("#"+t.getWrapperId()).innerHTML+=n,t.toInfinityAndBeyond()})}}),t.addEvents()},Pager.prototype.onVisibilityChangeHandler=function(){return null},dg_pager.load=function(t){return dg._pagers[t]?dg._pagers[t]:null},dg_pager.clearAll=function(){for(var t in dg._pagers)if(dg._pagers.hasOwnProperty(t)){var e=dg._pagers[t];e.isInfinite()&&e.removeEvents()}},dg_pager.onclickHandler=function(t,e){var r=dg_pager.load(t),n=r.getPage();r.setPage("next"==e?n+1:n-1),r.render().then(function(){dg.qs("#"+r.id()).scrollIntoView()})},dg_pager.infiniteScrollEventListeners=function(){return["DOMContentLoaded","load","scroll","resize"]},dg_pager.infiniteScrollEvents=function(){return["onDOMContentLoaded","onload","onscroll","onresize"]},dg_pager.isElementInViewport=function(t){if(t){var e=t.getBoundingClientRect(),r=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,i=e.top>=0&&e.left>=0&&e.bottom<=r&&e.right<=n;return i}},dg.theme_pager=function(t){var e=t._attributes.id,r=dg_pager.load("id");return r||(r=new Pager(e,t)),setTimeout(function(){r.render()},1),r.html()};