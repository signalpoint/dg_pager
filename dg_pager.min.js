function onVisibilityChange(e,t){var n;return function(){var r=dg_pager.isElementInViewport(e);r!=n&&(n=r,"function"==typeof t&&t(r))}}function dg_pager_pre_process_route_change(e,t){"undefined"==typeof t||dg_pager.clearAll()}dg.createModule("dg_pager"),dg._pagers={};var Pager=function(e,t){this._id=e,this._variables=t,this._query=null,this._eventsAdded=!1,this._data={page:"undefined"!=typeof t._page?t._page:0,limit:t._limit?t._limit:10},dg._pagers[this.id()]=this};Pager.prototype.id=function(){return this._id},Pager.prototype.getVars=function(){return this._variables},Pager.prototype.getVar=function(e){return this.getVars()["_"+e]},Pager.prototype.getFetcher=function(){return this.getVar("fetcher")},Pager.prototype.getWrapperId=function(){return this.getVar("wrapperId")},Pager.prototype.getWrapper=function(){return this.getVar("wrapper")},Pager.prototype.getWrapperTheme=function(){return this.getWrapper()({})._theme},Pager.prototype.getDisplay=function(){return this.getVar("display")},Pager.prototype.setData=function(e){this._data=e},Pager.prototype.setPage=function(e){this.getData().page=e},Pager.prototype.setPages=function(e){this.getData().pages=e},Pager.prototype.setLimit=function(e){this.getData().limit=e},Pager.prototype.setCount=function(e){this.getData().count=e},Pager.prototype.setQuery=function(e){this._query=e},Pager.prototype.getData=function(e){return e?this._data[e]:this._data},Pager.prototype.getResults=function(){return this.getData("results")},Pager.prototype.getResultCount=function(){var e=this.getResults();return e?e.length:0},Pager.prototype.getPage=function(){return this.getData("page")},Pager.prototype.getPages=function(){return this.getData("pages")},Pager.prototype.getLimit=function(){return this.getData("limit")},Pager.prototype.getCount=function(){return this.getData("count")},Pager.prototype.getQuery=function(){return this._query},Pager.prototype.html=function(){var e=dg.attributes(this.getVar("attributes"));return"<div "+e+"></div>"},Pager.prototype.fetch=function(){var e=this,t=this.getFetcher();return this.setQuery({page:this.getPage(),pageSize:this.getLimit()}),new Promise(function(n,r){t(e.getQuery()).then(function(t){e.setData(t),n()})})},Pager.prototype.render=function(){var e=this;return new Promise(function(t,n){e.fetch().then(function(){var n=e.isInfinite(),r=e.renderRows(),i=n?"":e.renderPager();dg.qs("#"+e.id()).innerHTML=dg.render(e.getWrapper()(r))+i,n?(e.toInfinityAndBeyond(),t&&t()):t()})})},Pager.prototype.renderRows=function(){for(var e=this,t=[],n=this.getResults(),r=this.isInfinite(),i=n.length,o=e.getDisplay(),a=0;a<i;a++){var g=n[a],s=o.call(e,g);dg.attributesInit(s._text);var d=s._text._attributes.class;d.push(a%2?"even":"odd"),r?0==a&&0==e.getPage()?d.push("first"):a==i-1&&d.push("last"):0==a?d.push("first"):a==i-1&&d.push("last"),t.push(s)}return t},Pager.prototype.renderPager=function(){var e=this.id(),t=0!=this.getPage()?dg.b(dg.t("Go back"),{_attributes:{onclick:"dg_pager.onclickHandler('"+e+"', 'prev')"}}):"",n=this.getPage()!=this.getPages()-1?dg.b(dg.t("Load more"),{_attributes:{onclick:"dg_pager.onclickHandler('"+e+"', 'next')"}}):"";return t+n},Pager.prototype.isInfinite=function(){return this.getVar("infinite")},Pager.prototype.eventsAdded=function(){return this._eventsAdded},Pager.prototype.addEvents=function(){console.log(this.id(),"adding events");var e=this;if(window.addEventListener){var t=dg_pager.infiniteScrollEventListeners();t.forEach(function(t){addEventListener(t,e.onVisibilityChangeHandler,!1)})}else if(window.attachEvent){var n=dg_pager.infiniteScrollEvents();n.forEach(function(t){attachEvent(t,e.onVisibilityChangeHandler,!1)})}e._eventsAdded=!0},Pager.prototype.removeEvents=function(){console.log(this.id(),"removing events");var e=this;if(window.removeEventListener)for(var t=dg_pager.infiniteScrollEventListeners(),n=0;n<t.length;n++)removeEventListener(t[n],e.onVisibilityChangeHandler);else if(window.removeEvent)for(var r=dg_pager.infiniteScrollEvents(),i=0;i<r.length;i++)removeEvent(r[i],e.onVisibilityChangeHandler);e._eventsAdded=!1},Pager.prototype.toInfinityAndBeyond=function(){var e=this,t=this.getWrapperTheme(),n=document.getElementById(this.getVar("wrapperId")),r=n?n.lastChild:null;this.onVisibilityChangeHandler=onVisibilityChange(r,function(n){if(n){console.log("got to bottom!!",e.id()),e.removeEvents();var r="next",i=e.getPage(),o="next"==r?i+1:i-1;if(o<0)return;if(o>=e.getPages())return;e.setPage(o),e.fetch().then(function(){for(var n=e.renderRows(),r="",i=0;i<n.length;i++){var a=n[i];switch(t){case"bootstrap_item_list":r+=dg.render({_theme:"list_item",_item:a,_i:i*o+i,_total:n.length});break;case"container":r+=dg.render(a)}}dg.qs("#"+e.getWrapperId()).innerHTML+=r,e.toInfinityAndBeyond()})}}),e.addEvents()},Pager.prototype.onVisibilityChangeHandler=function(){return null},dg_pager.load=function(e){return dg._pagers[e]?dg._pagers[e]:null},dg_pager.clearAll=function(){for(var e in dg._pagers)if(dg._pagers.hasOwnProperty(e)){var t=dg._pagers[e];t.isInfinite()&&t.removeEvents()}},dg_pager.onclickHandler=function(e,t){var n=dg_pager.load(e),r=n.getPage();n.setPage("next"==t?r+1:r-1),n.render().then(function(){dg.qs("#"+n.id()).scrollIntoView()})},dg_pager.infiniteScrollEventListeners=function(){return["DOMContentLoaded","load","scroll","resize"]},dg_pager.infiniteScrollEvents=function(){return["onDOMContentLoaded","onload","onscroll","onresize"]},dg_pager.isElementInViewport=function(e){if(e){var t=e.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,r=window.innerWidth||document.documentElement.clientWidth,i=t.top>=0&&t.left>=0&&t.bottom<=n&&t.right<=r;return i}},dg.theme_pager=function(e){var t=e._attributes.id,n=dg_pager.load("id");return n||(n=new Pager(t,e)),setTimeout(function(){n.render()},1),n.html()};