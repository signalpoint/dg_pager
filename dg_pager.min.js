function onVisibilityChange(t,e){var n;return function(){var i=dg_pager.isElementInViewport(t);i!=n&&(n=i,"function"==typeof e&&e(i))}}function dg_pager_pre_process_route_change(t,e){"undefined"!=typeof e&&dg_pager.clearAll()}dg.createModule("dg_pager"),dg._pagers={};var Pager=function(t,e){this._id=t,this._variables=e,this._query=null,this._eventsAdded=!1,this._data={page:"undefined"!=typeof e._page?e._page:0,limit:e._limit?e._limit:10},e._infinite&&!e._infiniteOps&&(e._infiniteOps={pagesAllowed:2}),dg._pagers[this.id()]=this};Pager.prototype.id=function(){return this._id},Pager.prototype.getVars=function(){return this._variables},Pager.prototype.getVar=function(t){return this.getVars()["_"+t]},Pager.prototype.getOption=function(t){return this.getVars()._infiniteOps[t]},Pager.prototype.getFetcher=function(){return this.getVar("fetcher")},Pager.prototype.getWrapperId=function(){return this.getVar("wrapperId")},Pager.prototype.getWrapper=function(){return this.getVar("wrapper")},Pager.prototype.getWrapperTheme=function(){return this.getWrapper().call(this,{})._theme},Pager.prototype.getDisplay=function(){return this.getVar("display")},Pager.prototype.getEmpty=function(){return this.getVar("empty")},Pager.prototype.runDone=function(){var t=this.getVar("done");t&&t.call(this)},Pager.prototype.getList=function(){return dg.qs("#"+this.getWrapperId())},Pager.prototype.getItems=function(){return this.getList().children},Pager.prototype.getItem=function(t){return this.getItems()[t]},Pager.prototype.setData=function(t){this._data=t},Pager.prototype.setPage=function(t){this.getData().page=t},Pager.prototype.setPages=function(t){this.getData().pages=t},Pager.prototype.setLimit=function(t){this.getData().limit=t},Pager.prototype.setCount=function(t){this.getData().count=t},Pager.prototype.setQuery=function(t){this._query=t},Pager.prototype.getData=function(t){return t?this._data[t]:this._data},Pager.prototype.getResults=function(){return this.getData("results")},Pager.prototype.getResultCount=function(){var t=this.getResults();return t?t.length:0},Pager.prototype.getPage=function(){return this.getData("page")},Pager.prototype.getPages=function(){return this.getData("pages")},Pager.prototype.getLimit=function(){return this.getData("limit")},Pager.prototype.getCount=function(){return this.getData("count")},Pager.prototype.getQuery=function(){return this._query},Pager.prototype.html=function(){var t=dg.attributes(this.getVar("attributes"));return"<div "+t+"></div>"},Pager.prototype.fetch=function(){var t=this,e=this.getFetcher();return this.setQuery({page:this.getPage(),pageSize:this.getLimit()}),new Promise(function(n,i){e.call(t,t.getQuery()).then(function(e){t.setData(e),n()})})},Pager.prototype.render=function(){var t=this;return new Promise(function(e,n){t.fetch().then(function(){var n=dg.qs("#"+t.id());if(t.getResultCount()){var i=t.isInfinite(),r=t.renderRows(),o=i?"":t.renderPager(),a=t.getWrapper().call(t,r);n.innerHTML=dg.render(a)+o,i?(t.runDone(),t.toInfinityAndBeyond(),e&&e()):e()}else{var g=t.getEmpty();g&&(n.innerHTML=dg.render(g.call(t)))}})})},Pager.prototype.renderRows=function(){for(var t=this,e=[],n=this.getResults(),i=this.isInfinite(),r=n.length,o=t.getDisplay(),a=0;a<r;a++){var g=n[a],s=o.call(t,g);dg.isString(s)&&(s={_text:s}),dg.isString(s._text)&&(s._text={_markup:s._text}),dg.attributesInit(s._text);var p=s._text._attributes.class;p.push(a%2?"even":"odd"),i?0==a&&0==t.getPage()?p.push("first"):a==r-1&&p.push("last"):0==a?p.push("first"):a==r-1&&p.push("last"),e.push(s)}return e},Pager.prototype.renderPager=function(){var t=this.id(),e=0!=this.getPage()?dg.b(dg.t("Go back"),{_attributes:{onclick:"dg_pager.onclickHandler('"+t+"', 'prev')"}}):"",n=this.getPage()!=this.getPages()-1?dg.b(dg.t("Load more"),{_attributes:{onclick:"dg_pager.onclickHandler('"+t+"', 'next')"}}):"";return e+n},Pager.prototype.isInfinite=function(){return this.getVar("infinite")},Pager.prototype.eventsAdded=function(){return this._eventsAdded},Pager.prototype.getDirection=function(){return this._direction},Pager.prototype.setDirection=function(t){this._direction=t},Pager.prototype.getRowCountInDom=function(){return this.getList().childElementCount},Pager.prototype.getPagesInDom=function(){return Math.ceil(this.getRowCountInDom()/this.getLimit())},Pager.prototype.removeFromTop=function(){for(var t=this.getList(),e=this.getLimit(),n=0;n<e;n++){var i=t.childNodes[0];t.removeChild(i)}},Pager.prototype.removeFromBottom=function(){for(var t=this.getList(),e=t.childNodes.length,n=e-this.getLimit(),i=e-1;i>=n;i--){var r=t.childNodes[i];t.removeChild(r)}},Pager.prototype.addEvents=function(){var t=this;if(window.addEventListener){var e=dg_pager.infiniteScrollEventListeners();e.forEach(function(e){addEventListener(e,t.onVisibilityChangeHandler,{passive:!0}),addEventListener(e,t.firstItemOnVisibilityChangeHandler,{passive:!0})})}else if(window.attachEvent){var n=dg_pager.infiniteScrollEvents();n.forEach(function(e){attachEvent(e,t.onVisibilityChangeHandler,!1),attachEvent(e,t.firstItemOnVisibilityChangeHandler,!1)})}t._eventsAdded=!0},Pager.prototype.removeEvents=function(){var t=this;if(window.removeEventListener)for(var e=dg_pager.infiniteScrollEventListeners(),n=0;n<e.length;n++)removeEventListener(e[n],t.onVisibilityChangeHandler),removeEventListener(e[n],t.firstItemOnVisibilityChangeHandler);else if(window.removeEvent)for(var i=dg_pager.infiniteScrollEvents(),r=0;r<i.length;r++)removeEvent(i[r],t.onVisibilityChangeHandler),removeEvent(i[r],t.firstItemOnVisibilityChangeHandler);t._eventsAdded=!1},Pager.prototype.toInfinityAndBeyond=function(){var t=this,e=document.getElementById(this.getVar("wrapperId"));if(e){var n=e.firstChild;this.firstItemOnVisibilityChangeHandler=onVisibilityChange(n,function(e){if(e){if(0===t.getPage())return;t.removeEvents(),t._toInfinityAndBeyond("up")}});var i=e.lastChild;this.onVisibilityChangeHandler=onVisibilityChange(i,function(e){if(e){if(t.getPage()+1==t.getPages())return;t.removeEvents(),t._toInfinityAndBeyond("down")}}),t.addEvents()}},Pager.prototype._toInfinityAndBeyond=function(t){var e=this,n=this.getDirection(),i=n&&n!=t;this.setDirection(t);var r="down"==t,o=this.getPage(),a=this.getOption("pagesAllowed"),g=null;if(g=r?i?o+a:o+1:i?o-a:o-1,!(g<0||g>=this.getPages())){var s=this.getWrapperTheme(),p=this.getPagesInDom();if(p>=a){var d=null;r?(this.removeFromTop(),d=this.getLimit()*(a-1)-1,this.getItem(d).scrollIntoView({block:"end",inline:"start"})):(this.removeFromBottom(),d=this.getLimit()-1)}this.setPage(g),this.fetch().then(function(){for(var t=e.renderRows(),n="",i=0;i<t.length;i++){var o=t[i];switch(s){case"item_list":case"bootstrap_item_list":"bootstrap_item_list"==s&&dg_bootstrap.prepListItem(o),n+=dg.render({_theme:"list_item",_item:o,_i:i*g+i,_total:t.length});break;case"container":n+=dg.render(o)}}var a=dg.qs("#"+e.getWrapperId());r?a.innerHTML+=n:(a.insertAdjacentHTML("afterbegin",n),d=e.getLimit()-1,e.getItem(d).scrollIntoView()),e.runDone(),e.toInfinityAndBeyond()})}},Pager.prototype.onVisibilityChangeHandler=function(){return null},Pager.prototype.firstItemOnVisibilityChangeHandler=function(){return null},dg_pager.load=function(t){return dg._pagers[t]?dg._pagers[t]:null},dg_pager.clearAll=function(){for(var t in dg._pagers)if(dg._pagers.hasOwnProperty(t)){var e=dg._pagers[t];e.isInfinite()&&e.removeEvents()}},dg_pager.onclickHandler=function(t,e){var n=dg_pager.load(t),i=n.getPage();n.setPage("next"==e?i+1:i-1),n.render().then(function(){dg.qs("#"+n.id()).scrollIntoView()})},dg_pager.infiniteScrollEventListeners=function(){return["DOMContentLoaded","load","scroll","resize"]},dg_pager.infiniteScrollEvents=function(){return["onDOMContentLoaded","onload","onscroll","onresize"]},dg_pager.isElementInViewport=function(t){if(t){var e=t.getBoundingClientRect(),n=window.innerHeight||document.documentElement.clientHeight,i=window.innerWidth||document.documentElement.clientWidth,r=e.top>=0&&e.left>=0&&e.bottom<=n&&e.right<=i;return r}},dg.theme_pager=function(t){var e=t._attributes.id,n=dg_pager.load("id");return n||(n=new Pager(e,t)),setTimeout(function(){n.render()},1),n.html()};